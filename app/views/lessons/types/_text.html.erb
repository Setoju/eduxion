<% lesson ||= local_assigns[:lesson] || local_assigns.dig(:locals, :lesson) %>

<div class="lesson-content" data-controller="book" data-action="keydown->book#keydown" tabindex="0">
  <% if lesson&.content.present? %>
    <!-- Hidden content for JavaScript processing -->
    <div data-book-target="content" style="display: none;">
      <%= raw lesson.content %>
    </div>
    
    <!-- Book Container -->
    <div class="book-container">
      <div class="book">
        <div class="book-spine"></div>
        <div class="book-pages">
          <!-- Pages will be dynamically created -->
          <div class="book-page" data-book-target="page">
            <div class="page-content">
              <!-- Content will be inserted here by JavaScript -->
            </div>
          </div>
        </div>
        
        <!-- Page Navigation -->
        <div class="book-navigation">
          <div class="nav-left">
            <button class="btn btn-outline-secondary btn-sm" 
                    data-book-target="prevButton" 
                    data-action="click->book#previousPage"
                    title="Previous page (← or Left Arrow)">
              <i class="fas fa-chevron-left"></i> Previous
            </button>
          </div>
          
          <div class="nav-center">
            <span class="page-info">
              Page <span data-book-target="currentPage">1</span> of <span data-book-target="totalPages">1</span>
            </span>
            <div class="page-selector mt-2">
              <label for="page-select" class="visually-hidden">Go to page</label>
              <input type="number" id="page-select" class="form-control form-control-sm" 
                     min="1" data-action="change->book#goToPage input->book#goToPage"
                     title="Enter page number">
            </div>
          </div>
          
          <div class="nav-right">
            <button class="btn btn-outline-secondary btn-sm" 
                    data-book-target="nextButton" 
                    data-action="click->book#nextPage"
                    title="Next page (→ or Right Arrow or Spacebar)">
              Next <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="reading-instructions text-muted text-center mt-3">
      <small>
        <i class="fas fa-keyboard me-1"></i>
        Use arrow keys or spacebar to navigate • Click and drag to turn pages
      </small>
      <br>
      <small class="mt-1 d-block">
        <i class="fas fa-code me-1"></i>
        Supports Markdown: <code>#</code> headers, <code>**bold**</code>, <code>*italic*</code>, <code>`code`</code>, lists, and links
      </small>
    </div>
    
  <% else %>
    <div class="text-center text-muted py-5">
      <div class="book-placeholder">
        <i class="fas fa-book-open fa-3x mb-3 text-muted"></i>
        <p>No content available for this lesson.</p>
      </div>
    </div>
  <% end %>
</div>